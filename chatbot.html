<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="chatbot.css">
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessages }) {
          const [inputText, setInputText] = React.useState('');

          function saveInputText(event) {
            setInputText(event.target.value);
          }

          function sendMessage() {
            const newChatMessages = [
              ...chatMessages,
              {
                message: inputText,
                sender: 'user',
                id: crypto.randomUUID()
              }
            ]

            setChatMessages(newChatMessages);

            const response = Chatbot.getResponse(inputText);
            setChatMessages([
              ...newChatMessages,
              {
                message: response,
                sender: 'robot',
                id: crypto.randomUUID()
              }
            ]);

            setInputText('');
          }

          return (
              <div className="chat_input_container">
                <input 
                  placeholder="Send a message to Chatbot"
                  size="30"
                  onChange={saveInputText}
                  className="chat_input"
                  value={inputText}
                />
                <button
                onClick={sendMessage}
                className="send_button"
                >Send</button>
              </div>
            );
        }

        function ChatMessage({ message, sender }) {

          return (
            <div className={
              sender == 'user'
              ? 'chat_message_user'
              :'chat_message_robot'
            }>
              {sender === 'robot' && (
                <img src="robot.png"
                className="chat_message_profile"
                 />
              )}
              <div className="chat_message_text">
                {message}
              </div>
              {sender === 'user' && (
                <img src="user.png"
                className="chat_message_profile"
                 />
              )}
            </div>
          );
        }

        function ChatMessages({ chatMessages }) {
          const chatMessagesRef = React.useRef(null);

          React.useEffect(() => {
            const containerElem = chatMessagesRef.current

            if(containerElem) {
              containerElem.scrollTop = containerElem.scrollHeight
            }
          }, [chatMessages]);

          return (
            <div
              className="chat_message_container"
              ref={chatMessagesRef}>
              {chatMessages.map((chatMessage) => {
                return (
                  <ChatMessage
                    message={chatMessage.message}
                    sender={chatMessage.sender}
                    key={chatMessage.id}
                  />
                );
              })}
            </div>
          );
        }

        function App() {
          const [chatMessages, setChatMessages] = React.useState(
            [{
            message: 'hello chatbot',
            sender: 'user',
            id: 'id1'
          }, {
            message: 'Hello! How can I help you',
            sender: 'robot',
            id: 'id2'
          }, {
            message: 'can you get me todays date?',
            sender: 'user',
            id: 'id3'
          }, {
            message: 'Today is November 30',
            sender: 'robot',
            id: 'id4'
          }]
          );
          
          return (
            <div className="app_container">
              <ChatMessages
                chatMessages={chatMessages}
              />
              <ChatInput 
                chatMessages={chatMessages}
                setChatMessages={setChatMessages}
              />
            </div>
          );
        }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>